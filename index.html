<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–æ–ø-12 –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –®—Ä–∏—Ñ—Ç Inter –¥–ª—è –ª—É—á—à–µ–π —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∏ -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω */
        }
        .container {
            max-width: 90vw; /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
        }
        /* –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è –¥–ª—è —Å–ø–∏–Ω–Ω–µ—Ä–∞ */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .animate-spin-custom {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="p-4 bg-gray-100 min-h-screen flex flex-col items-center">
    <div class="container bg-white p-6 rounded-lg shadow-xl w-full">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">
            üìà –¢–æ–ø-10 –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
        </h1>

        <div id="loading-spinner" class="hidden flex justify-center items-center py-8">
            <div class="animate-spin-custom rounded-full h-12 w-12 border-4 border-t-4 border-blue-500 border-opacity-75"></div>
            <p class="ml-4 text-lg text-gray-600">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
        </div>

        <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md relative mb-4" role="alert">
            <strong class="font-bold">–û—à–∏–±–∫–∞!</strong>
            <span class="block sm:inline" id="error-text">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</span>
        </div>

        <div id="crypto-list" class="space-y-4">
            <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã -->
        </div>

        <button id="refresh-button" class="mt-8 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-full shadow-md transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
            –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
        </button>
    </div>

    <script>
        // !!! –û–ß–ï–ù–¨ –í–ê–ñ–ù–û: Ngrok –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º –ø–ª–∞–Ω–µ –º–µ–Ω—è–µ—Ç URL –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ!
        // !!! –í–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –û–ë–ù–û–í–õ–Ø–¢–¨ —ç—Ç–æ—Ç URL –ö–ê–ñ–î–´–ô –†–ê–ó, –∫–æ–≥–¥–∞ –≤—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç–µ `ngrok http 5000`.
        // !!! –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –ù–û–í–´–ô –ø—É–±–ª–∏—á–Ω—ã–π HTTPS-URL, –∫–æ—Ç–æ—Ä—ã–π ngrok –≤—ã–¥–∞–ª –°–ï–ô–ß–ê–° –¥–ª—è –≤–∞—à–µ–≥–æ –±—ç–∫–µ–Ω–¥-–ø—Ä–æ–∫—Å–∏ (–ø–æ—Ä—Ç 5000).
        // –ü—Ä–∏–º–µ—Ä: const BACKEND_API_URL = "https://ab1c2d3e.ngrok-free.app/api/top-crypto";
        const BACKEND_API_URL = " https://1d4b103807c6.ngrok.app/api/top-crypto"; 

        // API –∫–ª—é—á CoinMarketCap –±–æ–ª—å—à–µ –ù–ï –Ω—É–∂–µ–Ω –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ.

        const cryptoListDiv = document.getElementById('crypto-list');
        const loadingSpinner = document.getElementById('loading-spinner');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const refreshButton = document.getElementById('refresh-button');

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å–ª–∞ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ —Ç—ã—Å—è—á
        function formatNumber(num) {
            return num.toLocaleString('en-US', { maximumFractionDigits: 2 });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        function formatChange(change) {
            if (change === null || isNaN(change)) {
                return "N/A";
            }
            const sign = change >= 0 ? 'üü¢ +' : 'üî¥ ';
            return `${sign}${change.toFixed(2)}%`;
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        async function fetchCryptoData() {
            cryptoListDiv.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
            loadingSpinner.classList.remove('hidden'); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
            errorMessage.classList.add('hidden'); // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
            refreshButton.disabled = true; // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É

            try {
                // –ó–∞–ø—Ä–æ—Å —Ç–µ–ø–µ—Ä—å –∏–¥–µ—Ç –Ω–∞ –≤–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥-–ø—Ä–æ–∫—Å–∏
                const response = await fetch(BACKEND_API_URL);

                if (!response.ok) {
                    const errorJson = await response.json().catch(() => ({}));
                    let message = `–û—à–∏–±–∫–∞ HTTP –æ—Ç –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞: ${response.status} ${response.statusText}`;
                    if (errorJson.error) {
                        message += ` - ${errorJson.error}`;
                    }
                    if (errorJson.details) {
                        message += ` (–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: ${errorJson.details})`;
                    }
                    // –î–ª—è –æ—à–∏–±–∫–∏ "Failed to fetch" (–æ–±—ã—á–Ω–æ –∏–∑-–∑–∞ CORS –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º —Å–µ—Ç–∏),
                    // status –∏ statusText –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏.
                    if (response.status === 0 && !navigator.onLine) {
                        message = "–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.";
                    } else if (response.status === 0) {
                        message = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –∏–ª–∏ CORS: –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–º. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω.";
                    }
                    throw new Error(message);
                }

                const result = await response.json(); // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç –ø—Ä–æ–∫—Å–∏
                const data = result.data; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –ø–æ–ª–µ 'data'

                if (!data || data.length === 0) {
                    errorText.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞—Ö –æ—Ç –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞.";
                    errorMessage.classList.remove('hidden');
                    return;
                }

                const cryptoList = [];
                // –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä —É–∂–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª —Å—Ç–µ–π–±–ª–∫–æ–∏–Ω—ã –∏ –≤–∑—è–ª —Ç–æ–ø-10,
                // –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –∏—Ç–µ—Ä–∏—Ä—É–µ–º –ø–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º.
                for (const crypto of data) {
                    const symbol = crypto.symbol;
                    const name = crypto.name;

                    const price = crypto.price;
                    const volume24h = crypto.volume_24h;
                    const percentChange24h = crypto.percent_change_24h;
                    const percentChange7d = crypto.percent_change_7d;
                    const percentChange30d = crypto.percent_change_30d;

                    const priceStr = price !== null ? `$${price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 6 })}` : "N/A";
                    const volumeStr = volume24h !== null ? `$${formatNumber(volume24h)}` : "N/A";

                    const cryptoCard = `
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-all duration-200">
                            <h2 class="text-xl font-semibold text-gray-900 mb-2">${name} (${symbol})</h2>
                            <p class="text-gray-700"><strong class="text-blue-600">–¶–µ–Ω–∞:</strong> ${priceStr}</p>
                            <p class="text-gray-700"><strong class="text-indigo-600">–û–±—ä–µ–º (24—á):</strong> ${volumeStr}</p>
                            <p class="text-gray-700"><strong class="text-green-600">–ò–∑–º–µ–Ω–µ–Ω–∏–µ (24—á):</strong> ${formatChange(percentChange24h)}</p>
                            <p class="text-gray-700"><strong class="text-purple-600">–ò–∑–º–µ–Ω–µ–Ω–∏–µ (7–¥):</strong> ${formatChange(percentChange7d)}</p>
                            <p class="text-gray-700"><strong class="text-pink-600">–ò–∑–º–µ–Ω–µ–Ω–∏–µ (30–¥):</strong> ${formatChange(percentChange30d)}</p>
                        </div>
                    `;
                    cryptoList.push(cryptoCard);
                }

                if (cryptoList.length > 0) {
                    cryptoListDiv.innerHTML = cryptoList.join('');
                } else {
                    errorText.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Ç–æ–ø-10 –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç.";
                    errorMessage.classList.remove('hidden');
                }

            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                errorText.textContent = `–û—à–∏–±–∫–∞: ${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –±—ç–∫–µ–Ω–¥-–ø—Ä–æ–∫—Å–∏ –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω.`;
                errorMessage.classList.remove('hidden');
            } finally {
                loadingSpinner.classList.add('hidden'); // –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
                refreshButton.disabled = false; // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É
            }
        }

        // –ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', fetchCryptoData);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        refreshButton.addEventListener('click', fetchCryptoData);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Mini App
        // –≠—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–π Telegram –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ Mini App
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.ready(); // –£–≤–µ–¥–æ–º–ª—è–µ–º Telegram, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
            window.Telegram.WebApp.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É—é –≤—ã—Å–æ—Ç—É/—à–∏—Ä–∏–Ω—É
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–∞ —Ñ–æ–Ω–∞, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ –∏ –Ω—É–∂–Ω–æ
            if (window.Telegram.WebApp.setBackgroundColor) {
                window.Telegram.WebApp.setBackgroundColor('#f0f2f5'); // –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å body
            }
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –≤ Telegram Mini App
            // –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–∫—Ä—ã—Ç–∏–µ –Ω–∏–∂–Ω–µ–π –ø–∞–Ω–µ–ª–∏
            // window.Telegram.WebApp.setClosingConfirmation(true); // –ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
        }
    </script>
</body>
</html>
